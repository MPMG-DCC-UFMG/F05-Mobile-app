[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=MPMG-DCC-UFMG_Mobile&metric=alert_status)](https://sonarcloud.io/dashboard?id=MPMG-DCC-UFMG_Mobile)

# Mobile

Project of an application for the MP

## 1. Necessary steps

This section explain all the necessary setup to run the application

### 1.1. Google Maps

Before you run your application, you need a Google Maps API key.

follow the directions here:
https://developers.google.com/maps/documentation/android/start#get-key

Once you have your key (it starts with "AIza"), create a file "services_keys.xml" with the following  
content inside the folder **app/src/debug/res/values**. If the folder don't exist, create it. 

```bash
<resources>
    <string name="google_maps_key" templateMergeStrategy="preserve" translatable="false">YOUR_API_KEY</string>
</resources>
```

### 1.2. Sentry

To track all errors this application it's configure to use [Sentry](https://sentry.io) services.

To enable it, go to the same file you created in the previous section and add the following entry:

```bash
<string name="sentry_key" templateMergeStrategy="preserve" translatable="false">SENTRY_DSN_FOUND_IN_DOCUMENTATION</string>
```

### 1.3. Firebase

To authenticate in Twitter and Facebook the Firebase was used for this application. First it's necessary to create a project
in Firebase and download the file **google_services.json**. All the service setup can be done following the steps in
[Setup firebase](https://firebase.google.com/docs/android/setup).

* Follow this steps to enable [Sign In with Google](https://firebase.google.com/docs/auth/android/google-signin)
* Follow this steps to enable [Sign In with Twitter](https://firebase.google.com/docs/auth/android/twitter-login)
* Follow this steps to enable [Sign In with Facebook](https://firebase.google.com/docs/auth/android/facebook-login)

It's also necessary to add some variables to the file "services_keys.xml":

```bash
<string name="google_sign_in" templateMergeStrategy="preserve" translatable="false">GOOGLE_SIGN_CLIENT_ID</string>
```

### 1.3.1 Firebase tips

When registering a new application it's necessary to add the SHA1 of the key used when singing the application. When debugging the
app Android Studio uses a debug key that's in the IDE folder. A easy way to discover this key it's to run the command:

```bash
./gradlew signingReport
```

If you need to get the default keystore cert string you can use the command

```bash
keytool -exportcert -alias androiddebugkey -keystore ~/.android/debug.keystore | openssl sha1 -binary | openssl base64
```

And the debug default keystore pass automatically generated by Android Studio is:

```bash
Keystore name: "debug.keystore"
Keystore password: "android"
Key alias: "androiddebugkey"
Key password: "android"
CN: "CN=Android Debug,O=Android,C=US"
```

### 1.3.2 Facebook Sign In

When setting up a login with facebook and creating an application in the Facebook Developers dashboard, some lines to be placed
at manifest and keys are generated. All this it's already configured in the application, the only thing necessary it's to 
add two more lines into the file "services_keys.xml":

```bash
<string name="facebook_app_id" templateMergeStrategy="preserve" translatable="false"><FACEBOOK_APP_ID></string>
<string name="fb_login_protocol_scheme" templateMergeStrategy="preserve" translatable="false"><FB_LOGIN_PROTOCOL_SCHEME></string>
```

## 2. Third Party Libraries

The third party libraries used in the project were as follows:

* [Android Jetpack](https://developer.android.com/jetpack): set of libraries created by Google to accelerate the development of Android applications.
* [Koin](https://insert-koin.io/): dependency injection library.
* [Retrofit](https://square.github.io/retrofit/): HTTP client used for REST calls.
* [Glide](https://bumptech.github.io/glide/): image caching and loading library for Android.
* [Material Design](https://material.io/): library of components based on Material Design

## 3. Services

The services used in this application were:

* [Google Geocoding](https://developers.google.com/maps/documentation/geocoding/start?hl=pt): service used to decode latitude and longitude to address.
* [BigData Cloud](https://www.bigdatacloud.com/geocoding-apis): possible service to be used for reverse geocoding
* [ViaCEP](https://viacep.com.br/): API used to identify the address via zip code

## 4. App Architecture (Project Structure)

The design of Protector Scout V4 mobile app is based on SOLID principles and on Clean architecture model. Also, many of the project dependencies come from Android Jetpack.

Broadly speaking, the app is organized into three layers: Presentation (or UI), Domain (business logic) and Models.
The app code itself is actually divided into more packages, but they all fit to this organization.

The following diagram represents how most of the app components relate to each other.

<h1 align="center">
  <br>
  <a href="https://developer.android.com/jetpack/docs/guide"><img src="https://developer.android.com/topic/libraries/architecture/images/final-architecture.png" alt="App architecture"></a>
  <br>
</h1>

* Views (activities and fragments) should only handle interactions, like clicks or animations. 
* ViewModels are responsible for handling business logic.
* Repositories abstract the complexities of loading and storing data.

## 5. Sponsors

<h1 align="center">
  <a href="https://www.mpmg.mp.br/">
      <img src="./assets/mmpg_logo.png" alt="MPMG">
  </a>
  <br>
  <a href="https://sentry.io/">
      <img src="./assets/sentry-logo-black.png" alt="Sentry">
  </a>
  <br>
</h1>
